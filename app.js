var main=function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="/",e(0)}([function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}var o=r(1),i=n(o);r(9);new i["default"]({elem:elem,CHAT_OPTIONS:CHAT_OPTIONS})},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0}),r(2);var s=r(6),a=n(s),u=function(){function t(e){o(this,t),this._elem=e.elem,this._elem.innerHTML=(0,a["default"])(),this._formInput=this._elem.querySelector(".chatForm textarea"),this._formButton=this._elem.querySelector(".chatForm button"),this._messageHistory=this._elem.querySelector(".chatHistory"),this._usersList=this._elem.querySelector(".chatUsers"),this._errorChat=this._elem.querySelector(".chatForm .chatError"),this._errorPlace=this._elem.querySelector(".chatLogin .chatError"),this._name="",this._send=this._send.bind(this),this._keySend=this._keySend.bind(this),this._formInput.addEventListener("keydown",this._keySend),this._formButton.addEventListener("click",this._send),this._login=this._login.bind(this),this._keyLogin=this._keyLogin.bind(this),this._loginInput=this._elem.querySelector(".chatLogin input"),this._loginButton=this._elem.querySelector(".chatLogin button"),this._loginInput.addEventListener("keypress",this._keyLogin),this._loginButton.addEventListener("click",this._login),this._goodbye=this._goodbye.bind(this),window.addEventListener("beforeunload",this._goodbye)}return i(t,[{key:"_keySend",value:function(t){this._clearError(this._errorChat),t.ctrlKey&&13==t.keyCode&&this._send()}},{key:"_send",value:function(){if(""==this._formInput.value.length)return void this._error(this._errorChat,"Введите сообщение для отправки!");var t=this._formInput.value.replace(/\r\n|\r|\n/g,"<br>"),e=new XMLHttpRequest;e.open("POST","/send",!0),e.send(JSON.stringify({meassage:t,user:this._name})),this._formInput.value=""}},{key:"_keyLogin",value:function(t){13==t.keyCode&&this._login()}},{key:"_login",value:function(){this._clearError(this._errorPlace);var t=this._loginInput.value;if(t.length<3)return void this._error(this._errorPlace,"Логин должен быть больше 2 символов!");var e=this;this.httpSend("POST","/login",JSON.stringify({name:t})).then(function(t){var r=JSON.parse(t);r.error?e._error(e._errorPlace,r.error):(e._elem.querySelector(".chatLogin").hidden=!0,e._name=r.name,e._elem.querySelector(".chatUsername").innerHTML=" - "+e._name,e._getMessageList())},function(t){e._error(e._errorPlace,t),setTimeout(e._login(),500)})}},{key:"_getMessageList",value:function(){var t=this;fetch("/messages").then(function(t){if(200!=t.status)throw"Ошибка загрузки";var e=t.json();return e}).then(function(e){t._messageHistory.innerHTML=e.messages,t._usersList.innerHTML=e.users})["catch"](function(e){t._error(t._errorChat,e)}),setTimeout(t._getMessageList.bind(t),1e3)}},{key:"_goodbye",value:function(){if(this._name){var t=new XMLHttpRequest;t.open("POST","/close",!0),t.send(JSON.stringify({name:this._name}))}}},{key:"_error",value:function(t,e){t.innerHTML=e}},{key:"_clearError",value:function(t){t.innerHTML=""}},{key:"httpSend",value:function(t,e,r){return new Promise(function(n,o){var i=new XMLHttpRequest;i.open(t,e,!0),i.onload=function(){if(200==this.status)n(this.response);else{var t=Error(this.statusText);t.code=this.status,o(t)}},i.onerror=function(){o(Error("Network Error"))},i.send(r)})}}]),t}();e["default"]=u},function(t,e,r){var n=r(3);"string"==typeof n&&(n=[[t.id,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){e=t.exports=r(4)(),e.push([t.id,'.chatCommon{width:90%;margin:0 auto;display:flex}.chatHistory{margin-top:50px;width:85%;height:500px;border:2px solid #77a;border-radius:5px;padding:10px;background:#fafafa;overflow:auto;margin-right:10px}.chatHistory:before{content:"\\421\\43E\\43E\\431\\449\\435\\43D\\438\\44F";position:absolute;top:60px;font-weight:700;color:#55f}.chatHistory u{color:#aaa}.chatHistory i{color:#999}.chatHistory b{color:#416999}.chatUsers{margin-top:50px;top:50px;width:15%;height:500px;border:2px solid #77a;border-radius:5px;padding:10px;background:#fafafa;overflow:auto}.chatUsers:before{content:"\\41F\\43E\\43B\\44C\\437\\43E\\432\\430\\442\\435\\43B\\438";position:absolute;top:60px;font-weight:700;color:#55f}.chatUsers p{margin:0 0 5px}.chatUsers p:first-letter{font-weight:700;font-size:20px;color:#55f;text-transform:uppercase}.chatWelcome{width:90%;margin:0 auto;color:#009;padding:10px 0;border-bottom:1px solid #ddd}.chatUsername{font-weight:700}.chatForm{width:90%;margin:0 auto;margin-top:10px}.chatForm textarea{padding:0;width:100%;margin:0 auto;height:80px;border:1px solid #999;border-radius:5px}.chatForm button{float:right;width:200px}.chatLogin{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(100,200,255,.9)}.chatLogin div{width:400px;margin:0 auto;text-align:center;padding-top:20%}.chatError{color:#00f;font-size:80%}.chatForm .chatError{float:right;padding:10px 20px 0 0}',""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e];r[2]?t.push("@media "+r[2]+"{"+r[1]+"}"):t.push(r[1])}return t.join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(n[i]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),t.push(s))}},t}},function(t,e,r){function n(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=d[n.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](n.parts[i]);for(;i<n.parts.length;i++)o.parts.push(c(n.parts[i],e))}else{for(var s=[],i=0;i<n.parts.length;i++)s.push(c(n.parts[i],e));d[n.id]={id:n.id,refs:1,parts:s}}}}function o(t){for(var e=[],r={},n=0;n<t.length;n++){var o=t[n],i=o[0],s=o[1],a=o[2],u=o[3],c={css:s,media:a,sourceMap:u};r[i]?r[i].parts.push(c):e.push(r[i]={id:i,parts:[c]})}return e}function i(t,e){var r=v(),n=_[_.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),_.push(e);else{if("bottom"!==t.insertAt)throw Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(e)}}function s(t){t.parentNode.removeChild(t);var e=_.indexOf(t);e>=0&&_.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",i(t,e),e}function u(t){var e=document.createElement("link");return e.rel="stylesheet",i(t,e),e}function c(t,e){var r,n,o;if(e.singleton){var i=y++;r=m||(m=a(e)),n=l.bind(null,r,i,!1),o=l.bind(null,r,i,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=u(e),n=f.bind(null,r),o=function(){s(r),r.href&&URL.revokeObjectURL(r.href)}):(r=a(e),n=h.bind(null,r),o=function(){s(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}function l(t,e,r,n){var o=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=b(e,o);else{var i=document.createTextNode(o),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(i,s[e]):t.appendChild(i)}}function h(t,e){var r=e.css,n=e.media;e.sourceMap;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}function f(t,e){var r=e.css,n=(e.media,e.sourceMap);n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var o=new Blob([r],{type:"text/css"}),i=t.href;t.href=URL.createObjectURL(o),i&&URL.revokeObjectURL(i)}var d={},p=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}},g=p(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=p(function(){return document.head||document.getElementsByTagName("head")[0]}),m=null,y=0,_=[];t.exports=function(t,e){e=e||{},void 0===e.singleton&&(e.singleton=g()),void 0===e.insertAt&&(e.insertAt="bottom");var r=o(t);return n(r,e),function(t){for(var i=[],s=0;s<r.length;s++){var a=r[s],u=d[a.id];u.refs--,i.push(u)}if(t){var c=o(t);n(c,e)}for(var s=0;s<i.length;s++){var u=i[s];if(0===u.refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete d[u.id]}}}};var b=function(){var t=[];return function(e,r){return t[e]=r,t.filter(Boolean).join("\n")}}()},function(t,e,r){r(7);t.exports=function(t){var e=[];return e.push('<div class="chatWelcome">   2gis чат<span class="chatUsername"></span></div><div class="chatCommon"><div class="chatHistory"></div><div class="chatUsers"></div></div><div class="chatForm"><textarea placeholder="Для отправки сообщения в чат:\r\n - нажать CTRL+ENTER \r\n - кликнуть кнопку ниже"></textarea><button>Отправить</button><span class="chatError"></span></div><div class="chatLogin"><div><b>Введите, пожалуйста, логин</b><br><br><input><button>Войти</button><br><br><span class="chatError"></span></div></div>'),e.join("")}},function(t,e,r){"use strict";function n(t){return null!=t&&""!==t}function o(t){return(Array.isArray(t)?t.map(o):t&&"object"==typeof t?Object.keys(t).filter(function(e){return t[e]}):[t]).filter(n).join(" ")}function i(t){return a[t]||t}function s(t){var e=(t+"").replace(u,i);return e===""+t?t:e}e.merge=function c(t,e){if(1===arguments.length){for(var r=t[0],o=1;o<t.length;o++)r=c(r,t[o]);return r}var i=t["class"],s=e["class"];(i||s)&&(i=i||[],s=s||[],Array.isArray(i)||(i=[i]),Array.isArray(s)||(s=[s]),t["class"]=i.concat(s).filter(n));for(var a in e)"class"!=a&&(t[a]=e[a]);return t},e.joinClasses=o,e.cls=function(t,r){for(var n=[],i=0;i<t.length;i++)r&&r[i]?n.push(e.escape(o([t[i]]))):n.push(o(t[i]));var s=o(n);return s.length?' class="'+s+'"':""},e.style=function(t){return t&&"object"==typeof t?Object.keys(t).map(function(e){return e+":"+t[e]}).join(";"):t},e.attr=function(t,r,n,o){return"style"===t&&(r=e.style(r)),"boolean"==typeof r||null==r?r?" "+(o?t:t+'="'+t+'"'):"":0==t.indexOf("data")&&"string"!=typeof r?(-1!==JSON.stringify(r).indexOf("&"),r&&"function"==typeof r.toISOString," "+t+"='"+JSON.stringify(r).replace(/'/g,"&apos;")+"'"):n?(r&&"function"==typeof r.toISOString," "+t+'="'+e.escape(r)+'"'):(r&&"function"==typeof r.toISOString," "+t+'="'+r+'"')},e.attrs=function(t,r){var n=[],i=Object.keys(t);if(i.length)for(var s=0;s<i.length;++s){var a=i[s],u=t[a];"class"==a?(u=o(u))&&n.push(" "+a+'="'+u+'"'):n.push(e.attr(a,u,!1,r))}return n.join("")};var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},u=/[&<>"]/g;e.escape=s,e.rethrow=function l(t,e,n,o){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&e||o))throw t.message+=" on line "+n,t;try{o=o||r(8).readFileSync(e,"utf8")}catch(i){l(t,null,n)}var s=3,a=o.split("\n"),u=Math.max(n-s,0),c=Math.min(a.length,n+s),s=a.slice(u,c).map(function(t,e){var r=e+u+1;return(r==n?"  > ":"    ")+r+"| "+t}).join("\n");throw t.path=e,t.message=(e||"Jade")+":"+n+"\n"+s+"\n\n"+t.message,t},e.DebugItem=function(t,e){this.lineno=t,this.filename=e}},function(t,e){},function(t,e,r){var n=r(10);"string"==typeof n&&(n=[[t.id,n,""]]);r(5)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,r){e=t.exports=r(4)(),e.push([t.id,"*{font-family:Calibri,Arial;font-size:20px}",""])}]);